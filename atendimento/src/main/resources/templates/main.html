<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Z.O. Emergências - Buscar Hospital</title>
    <link rel="stylesheet" href="/css/main_style.css">
    <script async src="https://maps.googleapis.com/maps/api/js?key=CHAVE&callback=initMap"></script>
    <!-- <script type="text/javascript" src="/js/javas.js"></script> -->
</head>

<body>
    <header class="header">
        <a href="/" class="logo">
            <img src="/img/iconPNG.png" alt="Logo Z.O. Emergências" class="logo-img">
            <span class="logo-text">Z.O. Emergências</span>
        </a>

        <nav class="nav">
            <a href="/" class="nav-link">Início</a>
            <a href="#" class="nav-link">Sobre o projeto</a>
        </nav>
    </header>
    <main class="main-content">

        <aside class="barra-lateral">

            <div class="bloco-info">

                <h3>Nova Solicitação:</h3>
                <form action="/buscarHospital" method="post">
                    <div class="campo-bairro">

                        <label for="bairro-select">Bairro:</label>
                        <select id="bairro-select" name="bairro" required>
                            <option value="">Selecione um Bairro</option>
                            <option th:each="bairro : ${bairros}" th:value="${bairro.nomeBairro}"
                                th:text="${bairro.nomeBairro}" th:selected="${bairro.nomeBairro == bairroSelecionado}">
                            </option>
                        </select>

                    </div>
                    <button type="submit" class="botao-localizar-unidade" id="btn-localizar-unidade">
                        Localizar Unidade de Saúde
                    </button>
                </form>
            </div>

            <div class="bloco-resultado">
                <h2 class="titulo-resultado">Resultado da Busca</h2>
                <div id="resultado-operacao">
                    <div class="unidade-destaque" th:if="${hospital != null}">
                        <p class="nome-unidade"><span
                                th:text="${hospital.nomeHospital} + ' - ' + ${hospital.bairro.nomeBairro}"></p>
                        <p><strong>Lotação Livres: </strong><span
                                th:text="${(hospital.lotacaoTotal - hospital.lotacaoOcupada)}"></span></p>
                        <p><strong>Lotação atual: </strong>
                            <span
                                th:text="${T(java.lang.Math).round((hospital.lotacaoOcupada * 100.0) / hospital.lotacaoTotal)} + '%'"></span>
                        </p>
                    </div>
                    <div th:if="${hospital == null}">
                        <p>Nenhum hospital encontrado para o bairro selecionado.</p>
                    </div>
                </div>

                <div class="controles-resultado">

                    <form action="/confirmarAtendimento" method="post" style="display: inline;">
                        <div th:if="${hospital != null}">
                            <input type="hidden" name="idHospital" th:value="${hospital.idHospital}" />
                        </div>
                        <button type="submit" class="botao-acao" id="btn-confirmar"
                            th:disabled="${!resultadoEncontrado}">
                            Confirmar
                        </button>
                    </form>

                    <form action="/localizarNovamente" method="post" style="display: inline;">
                        <input type="hidden" name="bairro" th:value="${bairroSelecionado}" />
                        <button type="submit" class="botao-acao" id="btn-localizar-novamente"
                            th:disabled="${!resultadoEncontrado}">
                            Localizar Novamente
                        </button>
                    </form>

                </div>

                <div th:if="${mensagem}" class="mensagem">
                    <p th:text="${mensagem}"></p>
                </div>
            </div>
        </aside>

        <div class="main-content-direita">
            <div class="bloco-central-topo">
                <div class="mapa-com-botoes">
                    <div id="mapa-container"></div>
                    <div class="controles-mapa">
                        <button class="botao-mapa" id="btn-alternar"> Botão 1 </button>
                        <form action="/abrirModal" method="post">
                            <button class="botao-mapa" id="btn-fullscreen"> Visualizar Mapa </button>
                        </form>

                    </div>
                </div>

            </div>

            <div id="tabela-detalhes">
                <h3>Unidades de Saúde na Região Oeste</h3>
                <table class="tabela-unidades">
                    <thead>
                        <tr>
                            <th>Unidade</th>
                            <th>Bairro</th>
                            <th>Lotação Máxima</th>
                            <th>Lotação Atual</th>
                        </tr>
                    </thead>
                    <tbody id="corpo-tabela-unidades">
                        <!-- Itera sobre os hospitais vindos do Controller -->
                        <tr th:each="hospital : ${hospitais}" class="unidade-row"
                            th:data-unidade-id="${hospital.idHospital}">
                            <td th:text="${hospital.nomeHospital}">Nome do Hospital</td>
                            <td th:text="${hospital.bairro.nomeBairro}">Bairro</td>
                            <td th:text="${hospital.lotacaoTotal}">0</td>
                            <td th:text="${hospital.lotacaoOcupada}">0</td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(hospitais)}">
                            <td colspan="4">Nenhuma Unidade encontrada</td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </main>
    <div id="modal-imagem" class="modal" th:if="${modalAberto}">
    <div class="modal-conteudo">
        <!-- Botão X no canto superior -->
        <form method="post" action="/fecharModal" style="position:absolute; top:10px; right:10px;">
            <button type="submit" class="fechar-modal" 
                style="background:none; border:none; font-size:1.5rem; color:white; cursor:pointer;">&times;</button>
        </form>
        
        <!-- Imagem do mapa -->
        <img th:src="@{/img/Mapa.jpg}" alt="Mapa" class="imagem-modal">
    </div>
</div>






</body>

</html>